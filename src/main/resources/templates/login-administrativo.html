<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Login Administrativo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/modern-normalize/2.0.0/modern-normalize.min.css" integrity="sha512-WPX7rlaR271GGBqBPdZiZsaAJ+lZeXqIuAvV38DSHLVYDBlnJrped1IovnHgwlHGawEq+y3OC/qoTr4ci9PX7A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 2rem; 
            background: #f8fafc; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            min-height: 100vh;
        }
        h1 { color: #1f2937; margin-bottom: 0.5rem; }
        .subtitle { color: #6b7280; margin-bottom: 2rem; text-align: center; }
        a { align-self: flex-start; color: #2563eb; text-decoration: none; margin-bottom: 2rem; }
        a:hover { text-decoration: underline; }
        form { 
            background: white; 
            padding: 2rem; 
            border-radius: 12px; 
            box-shadow: 0 10px 25px rgba(15,23,42,0.1); 
            width: 100%; 
            max-width: 400px; 
            border: 1px solid #e5e7eb;
        }
        label { display: block; margin-top: 1rem; font-weight: 600; color: #374151; }
        input { 
            width: 100%; 
            padding: 0.75rem; 
            margin-top: 0.5rem; 
            border-radius: 8px; 
            border: 1px solid #d1d5db; 
            font-size: 1rem;
            transition: border-color 0.2s;
        }
        input:focus {
            outline: none;
            border-color: #dc2626;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }
        button { 
            margin-top: 1.5rem; 
            padding: 0.9rem 1.2rem; 
            background: #dc2626; 
            color: white; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            width: 100%; 
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        button:hover { background: #b91c1c; }
        button:active { transform: translateY(1px); }
        pre { 
            margin-top: 1.5rem; 
            background: #0f172a; 
            color: #f8fafc; 
            padding: 1.5rem; 
            border-radius: 8px; 
            width: 100%; 
            max-width: 400px; 
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .success { 
            background: #dcfce7 !important; 
            color: #166534 !important; 
            border: 1px solid #bbf7d0;
        }
        .error { 
            background: #fef2f2 !important; 
            color: #dc2626 !important; 
            border: 1px solid #fecaca;
        }
        .admin-info {
            background: #fef3c7 !important;
            color: #92400e !important;
            border: 1px solid #fde68a;
        }
        .warning {
            background: #fffbeb !important;
            color: #92400e !important;
            border: 1px solid #fcd34d;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
<a href="/">‚Üê Volver al inicio</a>
<h1>Login Administrativo</h1>
<p class="subtitle">Acceso restringido para personal administrativo</p>

<div class="warning">
    ‚ö†Ô∏è <strong>Acceso restringido</strong><br>
    Solo para administradores y supervisores del sistema
</div>

<form id="login-form">
    <label>Correo administrativo
        <input type="email" name="correo" placeholder="admin@upt.edu.pe" required>
    </label>
    <label>Contrase√±a
        <input type="password" name="password" placeholder="Contrase√±a administrativa" required>
    </label>
    <button type="submit">Acceder al panel administrativo</button>
</form>

<pre id="result">Ingresa tus credenciales administrativas...</pre>

<script>
    const result = document.getElementById('result');
    const loginForm = document.getElementById('login-form');

    loginForm.addEventListener('submit', async (event) => {
        event.preventDefault();
        
        // Mostrar estado de carga
        result.textContent = "üîê Verificando credenciales administrativas...";
        result.className = '';
        
        const data = Object.fromEntries(new FormData(event.target).entries());
        
        try {
            // ‚úÖ CORREGIDO: Usa el endpoint correcto
            const response = await fetch('/auth/login-administrativo', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            
            const responseText = await response.text();
            
            if (response.ok) {
                // Login exitoso
                try {
                    const loginData = JSON.parse(responseText);
                    result.className = 'admin-info';
                    result.textContent = `‚úÖ ACCESO ADMINISTRATIVO AUTORIZADO\n\nüë§ Usuario: ${loginData.nombreCompleto}\nüéØ Tipo: ${loginData.tipoUsuario}\nüÜî ID: ${loginData.idUsuario}\nüìã Rol: ${loginData.idRol}\nüí¨ ${loginData.mensaje || 'Bienvenido al panel administrativo'}\n\n‚öôÔ∏è  Acceso a funciones administrativas: ACTIVADO`;
                } catch (e) {
                    result.className = 'success';
                    result.textContent = `‚úÖ ${response.status} ${response.statusText}\n${responseText}`;
                }
            } else {
                // Error en login
                result.className = 'error';
                
                try {
                    const errorData = JSON.parse(responseText);
                    result.textContent = `‚ùå ACCESO DENEGADO\n\n${errorData.message || errorData.error || responseText}\n\nüîí Solo personal autorizado puede acceder.`;
                } catch (e) {
                    result.textContent = `‚ùå ${response.status} ${response.statusText}\n${responseText}`;
                }
            }
        } catch (error) {
            // Error de red
            result.className = 'error';
            result.textContent = `‚ùå ERROR DE CONEXI√ìN\n\nNo se pudo conectar con el servidor. Verifica tu conexi√≥n a internet.`;
            console.error('Error:', error);
        }
    });

    // Limpiar resultado cuando el usuario empiece a escribir
    loginForm.addEventListener('input', () => {
        if (result.textContent !== "Ingresa tus credenciales administrativas...") {
            result.textContent = "Ingresa tus credenciales administrativas...";
            result.className = '';
        }
    });
</script>
</body>
</html>